<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marsle</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            position: relative;
        }
        .grid {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        .row {
            display: grid;
            grid-template-columns: repeat(6, 40px) 20px repeat(4, 40px);
            gap: 5px;
        }
        .cell {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ccc;
            font-size: 24px;
            text-transform: uppercase;
            cursor: pointer;
        }
        .space {
            width: 20px;
        }
        .correct {
            background-color: #6aaa64;
            color: white;
        }
        .present {
            background-color: #c9b458;
            color: white;
        }
        .absent {
            background-color: #787c7e;
            color: white;
        }
        .divider {
            width: 100%;
            height: 2px;
            background-color: #ccc;
            margin: 5px 0;
        }
        .divider-dark {
            width: 100%;
            height: 2px;
            background-color: #999;
            margin: 5px 0;
        }
        .back-button {
            display: none;
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            opacity: 0;
            animation: fadeIn 2s forwards;
        }
        .confetti {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <h1>Marsle</h1>
    <div class="grid" id="grid">
        <!-- Alte Raten werden hier dynamisch eingefügt -->
    </div>
    <div class="row" id="inputRow">
        <!-- Eingabezellen -->
    </div>
    <button class="back-button" id="backButton" onclick="location.href='index.html?showWo=true&showWas=true&showAll'">Zurück</button>
    <canvas id="confetti" class="confetti"></canvas>

    <script>
        const word = "escaperoom";
        const grid = document.getElementById('grid');
        const inputRow = document.getElementById('inputRow');
        const confettiCanvas = document.getElementById('confetti');
        let confetti;
        let currentInput = new Array(10).fill('');

        // Eingabezellen initialisieren
        for (let i = 0; i < 6; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = 'input-cell-' + i;
            cell.setAttribute('contenteditable', 'true');
            cell.addEventListener('input', (event) => handleInput(event, i));
            cell.addEventListener('keydown', (event) => moveToNextCell(event, i, 6));
            inputRow.appendChild(cell);
        }
        const space = document.createElement('div');
        space.className = 'space';
        inputRow.appendChild(space);
        for (let i = 0; i < 4; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = 'input-cell-' + (i + 6);
            cell.setAttribute('contenteditable', 'true');
            cell.addEventListener('input', (event) => handleInput(event, i + 6));
            cell.addEventListener('keydown', (event) => moveToNextCell(event, i + 6, 10));
            inputRow.appendChild(cell);
        }

        function handleInput(event, index) {
            let value = event.target.textContent.toLowerCase();
            if (value === ' ') {
                event.target.textContent = ''; // Clear the space input
                return; // Dismiss the input
            }
            if (value.length > 1) {
                event.target.textContent = value.charAt(0);
                value = value.charAt(0);
            }
            currentInput[index] = value;

            // Zum nächsten Eingabefeld wechseln, wenn ein Zeichen eingegeben wurde
            const nextCell = document.getElementById('input-cell-' + (index + 1));
            if (nextCell && value && event.inputType !== 'deleteContentBackward') {
                nextCell.focus();
            }
        }

        function moveToNextCell(event, index, maxIndex) {
            const key = event.key;
            if (key === 'Enter' || key === 'Return') {
                guess();
            } else if (key !== 'Backspace' && key !== 'Delete' && event.target.textContent.length === 1) {
                const nextCell = document.getElementById('input-cell-' + (index + 1));
                if (nextCell) {
                    nextCell.focus();
                }
            }
        }

        function createRow(guess) {
            const row = document.createElement('div');
            row.className = 'row';
            const letterCount = {};

            // Zählen der Buchstaben im Wort
            for (const letter of word) {
                letterCount[letter] = (letterCount[letter] || 0) + 1;
            }

            // Zuerst grüne Zellen markieren
            const result = new Array(10).fill('absent');
            for (let i = 0; i < 10; i++) {
                if (guess[i] === word[i]) {
                    result[i] = 'correct';
                    letterCount[guess[i]]--;
                }
            }

            // Dann gelbe Zellen markieren
            for (let i = 0; i < 10; i++) {
                if (result[i] !== 'correct' && word.includes(guess[i]) && letterCount[guess[i]] > 0) {
                    result[i] = 'present';
                    letterCount[guess[i]]--;
                }
            }

            // Zellen erstellen und färben
            for (let i = 0; i < 6; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = guess[i];
                if (result[i] === 'correct') {
                    cell.classList.add('correct');
                } else if (result[i] === 'present') {
                    cell.classList.add('present');
                } else {
                    cell.classList.add('absent');
                }
                row.appendChild(cell);
            }
            const space = document.createElement('div');
            space.className = 'space';
            row.appendChild(space);
            for (let i = 6; i < 10; i++) {
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.textContent = guess[i];
                if (result[i] === 'correct') {
                    cell.classList.add('correct');
                } else if (result[i] === 'present') {
                    cell.classList.add('present');
                } else {
                    cell.classList.add('absent');
                }
                row.appendChild(cell);
            }
            return row;
        }

        function guess() {
            for (let i = 0; i < 10; i++) {
                const cellContent = currentInput[i];
                if (!/^[a-z]$/.test(cellContent)) {
                    return;
                }
            }

            const guess = currentInput.join('');
            if (guess === word) {
                startConfetti();
                const backButton = document.getElementById('backButton');
                backButton.style.display = 'block';
                backButton.style.opacity = '1';

                // Disable input cells
                for (let i = 0; i < 10; i++) {
                    const cell = document.getElementById('input-cell-' + i);
                    cell.setAttribute('contenteditable', 'false');
                    cell.style.cursor = 'default';
                }
            }

            const row = createRow(guess);
            grid.appendChild(row); // Append row at the bottom
            const divider = document.createElement('div');
            divider.className = 'divider';
            grid.appendChild(divider); // Append divider at the bottom

            // Eingabezellen zurücksetzen
            currentInput = new Array(10).fill('');
            for (let i = 0; i < 6; i++) {
                const cell = document.getElementById('input-cell-' + i);
                cell.textContent = '';
            }
            for (let i = 6; i < 10; i++) {
                const cell = document.getElementById('input-cell-' + i);
                cell.textContent = '';
            }
            document.getElementById('input-cell-0').focus();
        }

        function startConfetti() {
            const confettiSettings = { target: 'confetti', max: 200, size: 1.2, animate: true };
            confetti = new ConfettiGenerator(confettiSettings);
            confetti.render();
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Enter' || event.key === 'Return') {
                guess();
            }
        });

        // Fokussieren der ersten Eingabezelle beim Laden der Seite
        document.getElementById('input-cell-0').focus();

        // Include ConfettiGenerator library
        (function() {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/confetti-js@0.0.18/dist/index.min.js';
            script.async = true;
            document.head.appendChild(script);
        })();
    </script>
</body>
</html>
